# DB Admin Pro

Веб-приложение для администрирования PostgreSQL баз данных с минималистичным интерфейсом.

## Быстрый старт

### Требования

* Docker
* Docker Compose

### Установка и запуск

```bash
# 1. Клонировать репозиторий
git clone <repository-url>
cd <project-folder>

# 2. Создать файлы переменных окружения
# В корне проекта:
echo "DB_HOST=postgres" > .env
echo "DB_PORT=5432" >> .env
echo "DB_NAME=my_app_db" >> .env
echo "DB_USER=postgres" >> .env
echo "DB_PASSWORD=postgres" >> .env
echo "APP_HOST=0.0.0.0" >> .env
echo "APP_PORT=3000" >> .env

# В папке app:
cp .env app/.env

# 3. Запустить приложение
docker-compose up --build

# 4. Приложение будет доступно по адресу:
# http://localhost:3000
```

### Первоначальная настройка

> **Важно:** при первом запуске база данных пуста. Необходимо восстановить данные из бэкапа.

1. Откройте `http://localhost:3000`
2. Перейдите в раздел **«Сервисные функции»**
3. Нажмите **«Восстановление»**
4. Загрузите файл резервной копии (`.backup`)
5. Подтвердите восстановление
6. Обновите страницу — данные станут доступны

## Функциональность

### 1. Управление данными

* Просмотр таблиц с пагинацией
* CRUD-операции с записями
* Экспорт таблиц в **Excel** и **JSON**

### 2. Конструктор запросов

* Выполнение SQL-запросов
* Поддержка параметризованных запросов
* Экспорт результатов

### 3. Сервисные функции

* Создание полных бэкапов БД (`.backup`)
* Восстановление из бэкапов
* Архивация таблиц (экспорт + удаление)
* Удаление таблиц
* Полная очистка базы данных

## Структура проекта

```text
.
├── .env                    # Переменные окружения (корень)
├── app/
│   ├── .env               # Переменные окружения (дубликат)
│   ├── main.py            # FastAPI сервер
│   ├── database.py        # Работа с PostgreSQL
│   ├── requirements.txt   # Зависимости Python
│   └── templates/         # HTML-шаблоны
├── backups/               # Бэкапы (создаются автоматически)
├── exports/               # Экспорты данных
├── archives/              # Архивы таблиц
├── docker-compose.yml     # Docker Compose конфигурация
├── Dockerfile             # Docker-образ
└── README.md              # Документация
```

## Технический стек

* **Backend**: Python 3.9 + FastAPI
* **Database**: PostgreSQL 15
* **Frontend**: HTML / CSS / JavaScript
* **Infrastructure**: Docker + Docker Compose

## Основные команды Docker

```bash
# Запуск в фоне
docker-compose up -d --build

# Остановка
docker-compose down

# Логи
docker-compose logs -f

# Полная пересборка
docker-compose down -v
docker-compose build --no-cache
docker-compose up
```

## Переменные окружения

Оба файла `.env` **должны содержать одинаковые значения**:

```env
DB_HOST=postgres
DB_PORT=5432
DB_NAME=my_app_db
DB_USER=postgres
DB_PASSWORD=postgres
APP_HOST=0.0.0.0
APP_PORT=3000
```

## Устранение неполадок

### Ошибка порта 3000

```yaml
ports:
  - "3001:3000"
```

И обновите оба файла `.env`:

```env
APP_PORT=3001
```

### Пустая база данных после запуска

* Выполните восстановление из бэкапа
* Убедитесь, что файл имеет формат `.backup`
* Проверьте логи:

```bash
docker-compose logs -f app
```

### Ошибка подключения к PostgreSQL

```bash
docker-compose down
docker-compose up
```

### Отсутствуют файлы `.env`

```bash
# Корень проекта
cp .env.example .env

# Папка app
cp .env.example app/.env
```

### Конфликты `.env`

Приложение использует **два файла `.env`** для совместимости:

1. `./.env` — Docker Compose
2. `./app/.env` — приложение внутри контейнера

Значения переменных в них должны быть **идентичны**.

## Форматы файлов

* **Бэкапы**: PostgreSQL `.backup` (custom format)
* **Экспорты**: `.xlsx`, `.json`
* **Архивы**: бэкап + Excel + JSON

## Безопасность

* Подтверждение всех деструктивных операций
* Проверка зависимостей перед удалением
* Подтверждение фразой для критических действий
* Разграничение прав через интерфейс

## Примечания

* Используются два файла `.env` для совместимости
* Папки `backups/`, `exports/`, `archives/` создаются автоматически
* Рекомендуется делать бэкап перед опасными операциями

## Лицензия

MIT